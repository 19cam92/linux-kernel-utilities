before_script:
  - apt-get -qq update
  - apt-get -qq install bc git lsb-release whiptail ruby-full
  - git clone https://github.com/sstephenson/bats.git /tmp/bats
  - mkdir -p /tmp/local
  - bash /tmp/bats/install.sh /tmp/local
  - export PATH=$PATH:/tmp/local/bin
  - export TERM=xterm-256color
  - gem install fpm

variables:
  PKG_VER: "1.1.2"
  NAME: "linux-kernel-utilities"
  DESC: "Utilities to compile & update linux kernels for Debian and deriv's (e.g. Ubuntu, LinuxMint, etc.)"
  URL: "https://github.com/mtompkins/linux-kernel-utilities"
  A_INST: "hooks/fpm-after-install.sh"
  B_REMOVE: "hooks/fpm-before-uninstall.sh"
  MAINT: "mets_dev@outlook.com"
  ARCH: "all"

test:ubuntu:
  image: ubuntu:
  script:
    - bats --version
    - bats ./unitTesting/tests-linux-kernel-utilities.bats
    - fpm -s dir -t deb -n "${NAME}" -v "${PKG_VER}" -a "${ARCH}" --deb-no-default-config-files --after-install "${A_INST}" --before-remove "${B_REMOVE}" -m "${MAINT}" --description "${DESC}" --url "${URL}" ../linux-kernel-utilities=/opt
  artifacts:
    paths:
    - linux-kernel-utilities_${PKG_VER}_${ARCH}.deb

test:debian:
  image: debian
  script:
    - bats --version
    - bats ./unitTesting/tests-linux-kernel-utilities.bats
